// refer: https://github.com/Peng-YM/QuanX/blob/master/Tools/XMLParser/xml-parser.js
// refer: https://goessner.net/download/prj/jsonxml/json2xml.js
// minify: https://www.digitalocean.com/community/tools/minify
function XMLs(r){return new class{constructor(r){this.name="XML v0.1.3",this.opts=r,this.newLine=this.opts.includes("\n")?"\n":this.opts.includes("\r")?"\r":this.opts.includes("\r\n")?"\r\n":"\n"}parse(r=new String,t=""){const n={"&amp;":"&","&lt;":"<","&gt;":">","&apos;":"'","&quot;":'"'},s="@";let e=function r(t,n){if("string"==typeof t)return t;var e=t.r;if(e)return e;var f,o=function(r,t){if(!r.t)return;for(var n,e,f=r.t.split(/([^\s='"]+(?:\s*=\s*(?:'[\S\s]*?'|"[\S\s]*?"|[^\s'"]*))?)/),o=f.length,l=0;l<o;l++){var c=i(f[l]);if(c){n||(n={});var p=c.indexOf("=");if(p<0)c=s+c,e=null;else{e=c.substr(p+1).replace(/^\s+/,""),c=s+c.substr(0,p).replace(/\s+$/,"");var g=e[0];g!==e[e.length-1]||"'"!==g&&'"'!==g||(e=e.substr(1,e.length-2)),e=a(e)}t&&(e=t(c,e)),u(n,c,e)}}return n}(t,n),l=t.f,c=l.length;if(o||c>1)f=o||{},l.forEach((function(t){"string"==typeof t?u(f,"#",t):u(f,t.n,r(t,n))}));else if(c){var p=l[0];if(f=r(p,n),p.n){var g={};g[p.n]=f,f=g}}else f=t.c?null:"";n&&(f=n(t.n||"",f));return f}(function(r){for(var t=String.prototype.split.call(r,/<([^!<>?](?:'[\S\s]*?'|"[\S\s]*?"|[^'"<>])*|!(?:--[\S\s]*?--|\[[^\[\]'"<>]+\[[\S\s]*?]]|DOCTYPE[^\[<>]*?\[[\S\s]*?]|(?:ENTITY[^"<>]*?"[\S\s]*?")?[\S\s]*?)|\?[\S\s]*?\?)>/),n=t.length,s={f:[]},e=s,u=[],f=0;f<n;){var o=t[f++];o&&g(o);var l=t[f++];l&&c(l)}return s;function c(r){var t=r.length,n=r[0];if("/"===n)for(var s=r.replace(/^\/|[\s\/].*$/g,"").toLowerCase();u.length;){var i=e.n&&e.n.toLowerCase();if(e=u.pop(),i===s)break}else if("?"===n)p({n:"?",r:r.substr(1,t-2)});else if("!"===n)"[CDATA["===r.substr(1,7)&&"]]"===r.substr(-2)?g(r.substr(8,t-10)):p({n:"!",r:r.substr(1)});else{var a=function(r){var t={f:[]},n=(r=r.replace(/\s*\/?$/,"")).search(/[\s='"\/]/);n<0?t.n=r:(t.n=r.substr(0,n),t.t=r.substr(n));return t}(r);p(a),"/"===r[t-1]?a.c=1:(u.push(e),e=a)}}function p(r){e.f.push(r)}function g(r){(r=i(r))&&p(a(r))}}(r),t);return e;function i(r){return r&&r.replace(/^\s+|\s+$/g,"")}function a(r){return r.replace(/(&(?:lt|gt|amp|apos|quot|#(?:\d{1,6}|x[0-9a-fA-F]{1,5}));)/g,(function(r){if("#"===r[1]){var t="x"===r[2]?parseInt(r.substr(3),16):parseInt(r.substr(2),10);if(t>-1)return String.fromCharCode(t)}return n[r]||r}))}function u(r,t,n){if(void 0!==n){var s=r[t];s instanceof Array?s.push(n):r[t]=t in r?[s,n]:n}}}stringify(r=new Object,t=""){var n="";for(var s in r)n+=e(r[s],s,"");return n=t?n.replace(/\t/g,t):n.replace(/\t|\n/g,"");function e(r,t,n){let s="";if(Array.isArray(r))s=r.reduce(((r,s)=>r+(n+e(s,t,n+"\t")+"\n")),"");else if("object"==typeof r){let i=!1;s+=n+"<"+t;for(let t in r)"@"==t.charAt(0)?s+=" "+t.substring(1)+'="'+r[t].toString()+'"':i=!0;if(s+=i?">":"/>",i){for(let t in r)"#"==t?s+=r[t]:"#cdata"==t?s+="<![CDATA["+r[t]+"]]>":"@"!=t.charAt(0)&&(s+=e(r[t],t,n+"\t"));s+=("\n"==s.charAt(s.length-1)?n:"")+"</"+t+">"}}else s+="?"===t?n+"<"+t+r.toString()+t+">":n+"<"+t+">"+r.toString()+"</"+t+">";return s}}}(r)}
