// refer: https://github.com/Peng-YM/QuanX/blob/master/Tools/XMLParser/xml-parser.js
// refer: https://goessner.net/download/prj/jsonxml/json2xml.js
// minify: https://www.digitalocean.com/community/tools/minify
function XMLs(t){return new class{#t="@";#s="#";#e={"&amp;":"&","&lt;":"<","&gt;":">","&apos;":"'","&quot;":'"'};#n={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&apos;",'"':"&quot;"};constructor(t){this.name="XML v0.2.0",this.opts=t}parse(t=new String,s=""){const e=this.#e,n=this.#t,r=this.#s;let o=function t(s,e){let o;switch(typeof s){case"string":case"undefined":o=s;break;case"object":const l=s.raw,u=s.tag,f=s.father;o=null===s?null:l||(u?function(t,s){if(!t)return;const e=t.split(/([^\s='"]+(?:\s*=\s*(?:'[\S\s]*?'|"[\S\s]*?"|[^\s'"]*))?)/),r=e.length;let o,l;for(let t=0;t<r;t++){let r=a(e[t]);if(!r)continue;o||(o={});const u=r.indexOf("=");if(u<0)r=n+r,l=null;else{l=r.substr(u+1).replace(/^\s+/,""),r=n+r.substr(0,u).replace(/\s+$/,"");const t=l[0];t!==l[l.length-1]||"'"!==t&&'"'!==t||(l=l.substr(1,l.length-2)),l=i(l)}s&&(l=s(r,l)),c(o,r,l)}return o}(u,e):{}),f&&f.forEach(((s,n)=>{s.tag||!1!==s.hasChild?c(o,"string"==typeof s?r:s.name,t(s,e),void 0):c(o,s.name,s.name,f?.[n-1]?.name)})),0===Object.keys(o).length&&(o=!1===s.hasChild?null:""),e&&(o=e(s.name||"",o))}return o;function c(t,s,e,n=s){if(void 0!==e){const r=t[n];Array.isArray(r)?r.push(e):r?t[n]=[r,e]:t[s]=e}}}(function(t){const s=t.split(/<([^!<>?](?:'[\S\s]*?'|"[\S\s]*?"|[^'"<>])*|!(?:--[\S\s]*?--|\[[^\[\]'"<>]+\[[\S\s]*?]]|DOCTYPE[^\[<>]*?\[[\S\s]*?]|(?:ENTITY[^"<>]*?"[\S\s]*?")?[\S\s]*?)|\?[\S\s]*?\?)>/),e=s.length,n={father:[]};let r=n;const o=[];for(let t=0;t<e;){const e=s[t++];e&&u(e);const n=s[t++];n&&c(n)}return n;function c(t){const s=t.length,e=t[0];if("/"===e){const s=t.replace(/^\/|[\s\/].*$/g,"").toLowerCase();for(;o.length;){const t=r.name&&r.name.toLowerCase();if(r=o.pop(),t===s)break}}else if("?"===e)l({name:"?",raw:t.substr(1,s-2)});else if("!"===e)"[CDATA["===t.substr(1,7)&&"]]"===t.substr(-2)?u(t.substr(8,s-10)):l({name:"!",raw:t.substr(1)});else{const e=function(t){const s={father:[]};t=t.replace(/\s*\/?$/,"");const e=t.search(/[\s='"\/]/);e<0?s.name=t:(s.name=t.substr(0,e),s.tag=t.substr(e));return s}(t);l(e),"/"===t[s-1]?e.hasChild=!1:(o.push(r),r=e)}}function l(t){r.father.push(t)}function u(t){(t=a(t))&&l(i(t))}}(t),s);return o;function a(t){return t&&t.replace(/^\s+|\s+$/g,"")}function i(t){return t.replace(/(&(?:lt|gt|amp|apos|quot|#(?:\d{1,6}|x[0-9a-fA-F]{1,5}));)/g,(function(t){if("#"===t[1]){const s="x"===t[2]?parseInt(t.substr(3),16):parseInt(t.substr(2),10);if(s>-1)return String.fromCharCode(s)}return e[t]||t}))}}stringify(t=new Object,s=""){this.#n;const e=this.#t,n=this.#s;let r="";for(let s in t)r+=o(t[s],s,"");return r=s?r.replace(/\t/g,s):r.replace(/\t|\n/g,""),r;function o(t,s,r){let a="";if(Array.isArray(t))a=t.reduce(((t,e)=>t+(r+o(e,s,r+"\t")+"\n")),"");else if("object"==typeof t){let i="",c="";for(let s in t)s.charAt(0)===e?i+=` ${s.substring(1)}="${t[s].toString()}"`:s.charAt(0)===n?c+="#cdata"===s?`<![CDATA[${t[s]}]]>`:t[s]:c+=o(t[s],s,r+"\t");let l=c.length;a+=`${r}<${s}${i}${l?"/":""}>`+l||("\n"==c.charAt(c.length-1)?r:"")+l?"":`</${s}>`}else a+="string"==typeof t?r+`<${t.toString()}/>`:"?"===s?r+`<${s}${t.toString()}${s}>`:r+`<${s}>${t.toString()}</${s}>`;return a}}}(t)}
